<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QBZ-DL | Premium Hi-Res Audio Downloader</title>
    <meta name="description"
        content="Premium high-resolution audio downloader with queue management, batch import, statistics, and more.">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body class="dark-theme">
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üéµ</span>
                <h1>QBZ-DL</h1>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-tab="queue">
                    <span class="icon">üì•</span> <span class="nav-label">Queue</span>
                </a>
                <a href="#" class="nav-item" data-tab="search">
                    <span class="icon">üîç</span> <span class="nav-label">Search</span>
                </a>
                <a href="#" class="nav-item" data-tab="batch">
                    <span class="icon">üì¶</span> <span class="nav-label">Batch Import</span>
                </a>
                <a href="#" class="nav-item" data-tab="statistics">
                    <span class="icon">üìä</span> <span class="nav-label">Analytics</span>
                </a>
                <a href="#" class="nav-item" data-tab="library">
                    <span class="icon">üìö</span> <span class="nav-label">Library</span>
                </a>
                <a href="#" class="nav-item" data-tab="playlists">
                    <span class="icon">üîÑ</span> <span class="nav-label">Playlists</span>
                </a>
                <a href="#" class="nav-item" data-tab="history">
                    <span class="icon">üìú</span> <span class="nav-label">History</span>
                </a>
                <a href="#" class="nav-item" data-tab="settings">
                    <span class="icon">‚öôÔ∏è</span> <span class="nav-label">Settings</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="https://ifauzeee.vercel.app/" target="_blank" class="creator-credit">by Muhammad Ibnu Fauzi</a>
            </div>
        </aside>
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <main class="main-content">
            <header class="top-bar">
                <div class="header-left" style="display: flex; align-items: center; gap: 15px;">
                    <button id="menu-toggle" class="btn secondary icon-btn">‚ò∞</button>
                    <h2 id="page-title">Download Queue</h2>
                </div>
                <div class="header-right" style="display: flex; gap: 10px;">
                    <button id="theme-toggle" class="btn secondary icon-btn" title="Toggle Theme">üåì</button>
                    <button id="add-btn" class="btn primary">
                        <span class="icon">+</span> <span class="desktop-only">Add URL</span>
                    </button>
                </div>
            </header>

            <!-- Queue View -->
            <div id="view-queue" class="view-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total</h3>
                        <div class="number" id="q-total">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Downloading</h3>
                        <div class="number text-accent" id="q-downloading">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Completed</h3>
                        <div class="number text-success" id="q-completed">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Failed</h3>
                        <div class="number text-danger" id="q-failed">0</div>
                    </div>
                </div>

                <div class="queue-toolbar">
                    <div class="queue-actions">
                        <button class="btn secondary" onclick="queueAction('pause')">‚è∏Ô∏è Pause</button>
                        <button class="btn secondary" onclick="queueAction('resume')">‚ñ∂Ô∏è Resume</button>
                        <button class="btn danger" onclick="queueAction('clear')">üóëÔ∏è Clear All</button>
                    </div>
                </div>

                <div class="list-container">
                    <div class="list-header">
                        <div>Title</div>
                        <div>Type</div>
                        <div>Quality</div>
                        <div>Status</div>
                        <div>Progress</div>
                        <div>Action</div>
                    </div>
                    <div id="queue-list" class="list-body">
                    </div>
                </div>
            </div>

            <!-- Search View -->
            <div id="view-search" class="view-section" style="display: none;">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search albums, tracks, or artists...">
                        <button class="btn primary" id="search-btn">Search</button>
                    </div>
                    <div class="search-types">
                        <button class="type-btn active" data-type="albums">Albums</button>
                        <button class="type-btn" data-type="tracks">Tracks</button>
                        <button class="type-btn" data-type="artists">Artists</button>
                    </div>
                </div>
                <div id="search-results" class="results-grid">
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <h3>Start Searching</h3>
                        <p>Enter keywords to search for albums, tracks, or artists</p>
                    </div>
                </div>
                <div id="search-pagination" class="pagination"></div>
            </div>

            <!-- Batch Import View -->
            <div id="view-batch" class="view-section" style="display: none;">
                <div class="batch-main-wrapper">
                    <div class="batch-editor-section">
                        <div class="batch-editor-header">
                            <h3>üì¶ Paste URLs</h3>
                            <span class="batch-url-badge"><span id="batch-url-count">0</span> URLs</span>
                        </div>
                        <textarea id="batch-urls" class="batch-textarea-full" placeholder="Paste Qobuz URLs here, one per line...

https://www.qobuz.com/album/...
https://www.qobuz.com/track/...
https://play.qobuz.com/album/...

# Lines starting with # are comments"></textarea>
                        <div class="batch-controls">
                            <div class="batch-quality-select">
                                <label>Quality:</label>
                                <select id="batch-quality">
                                    <option value="27">Hi-Res 24/192</option>
                                    <option value="7">Hi-Res 24/96</option>
                                    <option value="6">CD 16/44.1</option>
                                    <option value="5">MP3 320</option>
                                </select>
                            </div>
                            <div class="batch-buttons">
                                <button class="btn secondary" onclick="clearBatchUrls()">Clear</button>
                                <button class="btn primary" onclick="submitBatchImport()">
                                    üì• Import to Queue
                                </button>
                            </div>
                        </div>
                        <div id="batch-result-area" class="batch-result-inline"></div>
                    </div>
                    <div class="batch-tips-compact">
                        <strong>üí° Tip:</strong> Use the <kbd>+</kbd> button on search results to add items here.
                        Comments start with <kbd>#</kbd>
                    </div>
                </div>
            </div>

            <!-- Statistics/Analytics View (Combined) -->
            <div id="view-statistics" class="view-section" style="display: none;">
                <div class="analytics-header">
                    <h3>üìä Analytics Dashboard</h3>
                    <button class="btn secondary" onclick="refreshAnalytics()">üîÑ Refresh</button>
                </div>

                <!-- Summary Cards -->
                <div class="analytics-summary-grid">
                    <div class="stat-card large gradient-purple">
                        <div class="stat-icon">üéµ</div>
                        <div class="stat-details">
                            <h3>Total Tracks</h3>
                            <div class="number" id="stats-total">0</div>
                        </div>
                    </div>
                    <div class="stat-card large gradient-blue">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-details">
                            <h3>Total Duration</h3>
                            <div class="number" id="stats-duration">0h 0m</div>
                        </div>
                    </div>
                    <div class="stat-card large gradient-green">
                        <div class="stat-icon">üé§</div>
                        <div class="stat-details">
                            <h3>Unique Artists</h3>
                            <div class="number" id="stats-artists">0</div>
                        </div>
                    </div>
                    <div class="stat-card large gradient-orange">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-details">
                            <h3>Total Size</h3>
                            <div class="number" id="stats-size">0 B</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Row -->
                <div class="quick-stats-row">
                    <div class="quick-stat-item">
                        <span class="quick-stat-label">Today</span>
                        <span class="quick-stat-value" id="stats-today">0</span>
                    </div>
                    <div class="quick-stat-item">
                        <span class="quick-stat-label">This Week</span>
                        <span class="quick-stat-value" id="stats-week">0</span>
                    </div>
                    <div class="quick-stat-item">
                        <span class="quick-stat-label">This Month</span>
                        <span class="quick-stat-value" id="stats-month">0</span>
                    </div>
                    <div class="quick-stat-item">
                        <span class="quick-stat-label">Daily Average</span>
                        <span class="quick-stat-value" id="stats-avg">0</span>
                    </div>
                </div>

                <div class="analytics-section">
                    <h3>üåü Top Artists</h3>
                    <div id="artist-stats" class="artist-list-container"></div>
                </div>

                <div class="analytics-charts-grid">
                    <div class="chart-card full-width">
                        <h3>üìà Download Trends (Last 30 Days)</h3>
                        <div class="chart-container">
                            <canvas id="analytics-trend-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üéß Quality Distribution</h3>
                        <div id="quality-stats" class="quality-bars"></div>
                    </div>
                    <div class="chart-card">
                        <h3>üé∏ Genre Breakdown</h3>
                        <div id="genre-stats" class="genre-list"></div>
                    </div>
                </div>

                <div class="insights-section">
                    <h4>üí° Insights & Recommendations</h4>
                    <div id="analytics-insights" class="insights-list">
                        <div class="insight-item">Loading insights...</div>
                    </div>
                </div>


            </div>

            <!-- Album View -->
            <div id="view-album" class="view-section" style="display: none;">
                <button class="btn secondary" onclick="switchTab('search')" style="margin-bottom: 20px;">
                    <span class="icon">‚¨ÖÔ∏è</span> Back to Search
                </button>
                <div id="album-full-content">
                </div>
            </div>

            <!-- Artist View -->
            <div id="view-artist" class="view-section" style="display: none;">
                <button class="btn secondary" onclick="switchTab('search')" style="margin-bottom: 20px;">
                    <span class="icon">‚¨ÖÔ∏è</span> Back to Search
                </button>
                <div id="artist-full-content">
                </div>
                <div id="artist-pagination" class="pagination"></div>
            </div>



            <!-- Library Scanner View -->
            <div id="view-library" class="view-section" style="display: none;">
                <div class="library-header">
                    <h3>üìö Music Library Scanner</h3>
                    <div class="library-actions">
                        <button class="btn primary" id="scan-library-btn" onclick="startLibraryScan()">
                            üîç Scan Library
                        </button>
                        <button class="btn secondary" onclick="abortScan()">‚èπ Stop</button>
                    </div>
                </div>

                <!-- Scan Status -->
                <div id="scan-status" class="scan-status-card">
                    <div class="scan-indicator">
                        <span id="scan-status-icon">‚è∏</span>
                        <span id="scan-status-text">Not scanning</span>
                    </div>
                    <div class="scan-progress-container">
                        <progress id="scan-progress" value="0" max="100"></progress>
                        <span id="scan-percentage">0%</span>
                    </div>

                </div>

                <!-- Library Stats -->
                <div class="library-stats-grid">
                    <div class="stat-card">
                        <h3>Total Files</h3>
                        <div class="number" id="lib-total">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Duplicates</h3>
                        <div class="number text-warning" id="lib-duplicates">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Hi-Res</h3>
                        <div class="number text-accent" id="lib-upgradeable">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Size</h3>
                        <div class="number" id="lib-size">0 B</div>
                    </div>
                </div>

                <div class="library-tabs">
                    <button class="tab-btn active" data-library-tab="duplicates">‚ö†Ô∏è Duplicates</button>
                    <button class="tab-btn" data-library-tab="upgradeable">üéß Hi-Res Available</button>
                </div>

                <div id="library-duplicates-view" class="library-tab-content active">
                    <div id="duplicates-list" class="duplicates-list">
                        <div class="empty-state">
                            <div class="empty-icon">‚úÖ</div>
                            <h3>No Duplicates Found</h3>
                            <p>Scan your library to detect duplicate files</p>
                        </div>
                    </div>
                </div>

                <div id="library-upgradeable-view" class="library-tab-content" style="display: none;">
                    <div id="upgradeable-list" class="upgradeable-list">
                        <div class="empty-state">
                            <div class="empty-icon">üéµ</div>
                            <h3>No Files to Upgrade</h3>
                            <p>All your files are already in high quality</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="view-playlists" class="view-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Watched Playlists</h3>
                    <button id="add-playlist-btn" class="btn primary">
                        <span class="icon">+</span> Track New Playlist
                    </button>
                </div>
                <div class="list-container">
                    <div class="list-header" style="grid-template-columns: 2fr 1fr 1fr 1fr 1fr;">
                        <div>Title</div>
                        <div>Quality</div>
                        <div>Interval (Hrs)</div>
                        <div>Last Sync</div>
                        <div>Action</div>
                    </div>
                    <div id="playlists-list" class="list-body">
                    </div>
                </div>
            </div>

            <!-- History View -->
            <div id="view-history" class="view-section" style="display: none;">
                <div class="history-toolbar">
                    <div class="history-actions">
                        <button class="btn secondary" onclick="exportHistory('json')">
                            <span class="icon">üìÑ</span> Export JSON
                        </button>
                        <button class="btn secondary" onclick="exportHistory('csv')">
                            <span class="icon">üìä</span> Export CSV
                        </button>
                    </div>
                    <button id="clear-history-btn" class="btn danger">
                        <span class="icon">üóëÔ∏è</span> Delete All History
                    </button>
                </div>
                <div class="list-container">
                    <div class="list-header">
                        <div>Date</div>
                        <div>Title</div>
                        <div>Quality</div>
                        <div>Filename</div>
                        <div>Action</div>
                    </div>
                    <div id="history-list" class="list-body">
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view-section" style="display: none;">
                <!-- Credential Status Section -->
                <div class="settings-section">
                    <h3 class="section-title">
                        <span class="icon">üîê</span> Credential Status
                    </h3>
                    <div class="cred-status-grid">
                        <div class="cred-status-item">
                            <span class="cred-label">App ID</span>
                            <span id="cred-appid" class="cred-value">Checking...</span>
                        </div>
                        <div class="cred-status-item">
                            <span class="cred-label">App Secret</span>
                            <span id="cred-secret" class="cred-value">Checking...</span>
                        </div>
                        <div class="cred-status-item">
                            <span class="cred-label">Auth Token</span>
                            <span id="cred-token" class="cred-value">Checking...</span>
                        </div>
                        <div class="cred-status-item">
                            <span class="cred-label">User ID</span>
                            <span id="cred-userid" class="cred-value">Checking...</span>
                        </div>
                    </div>
                    <div class="cred-actions">
                        <button class="btn primary" onclick="validateCredentials()">
                            <span class="icon">üîÑ</span> Validate Credentials
                        </button>
                        <div id="cred-result" class="cred-result"></div>
                    </div>
                </div>

                <!-- Update Credentials Section -->
                <div class="settings-section">
                    <h3 class="section-title">
                        <span class="icon">‚úèÔ∏è</span> Update Credentials
                    </h3>
                    <p class="section-desc">Leave fields empty to keep current values. Changes are immediately saved to
                        .env file.</p>
                    <div class="update-cred-grid">
                        <div class="form-group">
                            <label>App ID</label>
                            <input type="password" id="update-appid" placeholder="Enter new App ID...">
                        </div>
                        <div class="form-group">
                            <label>App Secret</label>
                            <input type="password" id="update-secret" placeholder="Enter new Secret...">
                        </div>
                        <div class="form-group">
                            <label>Auth Token</label>
                            <input type="password" id="update-token" placeholder="Enter new Token...">
                        </div>
                        <div class="form-group">
                            <label>User ID</label>
                            <input type="text" id="update-userid" placeholder="Enter new User ID...">
                        </div>
                    </div>
                    <button class="btn primary" onclick="updateCredentials()">
                        <span class="icon">üíæ</span> Update Credentials
                    </button>
                </div>

                <!-- Current Settings Section -->
                <div class="settings-section">
                    <h3 class="section-title">
                        <span class="icon">üìÅ</span> Current Configuration
                    </h3>
                    <p class="section-desc">These settings are loaded from .env file. Restart server after changes.</p>
                    <div class="current-settings-grid">
                        <div class="setting-display-item">
                            <span class="setting-label">Download Path</span>
                            <span id="set-path" class="setting-value">-</span>
                        </div>
                        <div class="setting-display-item">
                            <span class="setting-label">Folder Template</span>
                            <span id="set-folder" class="setting-value">-</span>
                        </div>
                        <div class="setting-display-item">
                            <span class="setting-label">File Template</span>
                            <span id="set-file" class="setting-value">-</span>
                        </div>
                        <div class="setting-display-item">
                            <span class="setting-label">Max Concurrent</span>
                            <span id="set-concurrent" class="setting-value">-</span>
                        </div>
                    </div>
                </div>

                <!-- Theme Settings -->
                <div class="settings-section">
                    <h3 class="section-title">
                        <span class="icon">üé®</span> Appearance
                    </h3>
                    <div class="appearance-options">
                        <div class="form-group">
                            <label>Theme</label>
                            <select id="theme-select">
                                <option value="dark">Dark Mode</option>
                                <option value="light">Light Mode</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Language</label>
                            <select id="settings-lang">
                                <option value="en">English</option>
                                <option value="id">Bahasa Indonesia</option>
                                <option value="es">Espa√±ol</option>
                                <option value="fr">Fran√ßais</option>
                                <option value="de">Deutsch</option>
                                <option value="ja">Êó•Êú¨Ë™û</option>
                                <option value="zh">‰∏≠Êñá</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Modal -->
    <div id="add-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-modal')">&times;</span>
            <h2>Add Download</h2>
            <form id="add-form">
                <div class="form-group">
                    <label>Qobuz URL</label>
                    <input type="text" id="url-input" placeholder="https://play.qobuz.com/album/..." required>
                </div>
                <div class="form-group">
                    <label>Quality</label>
                    <select id="quality-input">
                        <option value="27">Hi-Res 24/192 (Default)</option>
                        <option value="7">Hi-Res 24/96</option>
                        <option value="6">CD Quality (16/44.1)</option>
                        <option value="5">MP3 320kbps</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary">Add to Queue</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Playlist Modal -->
    <div id="add-playlist-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-playlist-modal')">&times;</span>
            <h2>Track Playlist</h2>
            <form id="add-playlist-form">
                <div class="form-group">
                    <label>Playlist URL or ID</label>
                    <input type="text" id="playlist-id-input" placeholder="https://open.qobuz.com/playlist/..."
                        required>
                </div>
                <div class="form-group">
                    <label>Quality</label>
                    <select id="playlist-quality-input">
                        <option value="27">Hi-Res 24/192</option>
                        <option value="7">Hi-Res 24/96</option>
                        <option value="6">CD Quality (16/44.1)</option>
                        <option value="5">MP3 320kbps</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Sync Interval (Hours)</label>
                    <input type="number" id="playlist-interval-input" min="1" value="24" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary">Start Tracking</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay" style="display: none;">
        <div class="login-split-container">
            <div class="login-brand-side">
                <div class="brand-content">
                    <div class="logo">
                        <span class="logo-icon">üéµ</span>
                        <h1>QBZ-DL</h1>
                    </div>
                    <h2>Premium Hi-Res Downloader</h2>
                    <p>Access the ultimate toolkit for high-fidelity audio. Manage your queue, search the library, and
                        enjoy your music with complete metadata and lyrics.</p>
                    <div class="brand-features">
                        <div class="feature-item"><span class="feat-icon">üöÄ</span> Fast Downloads</div>
                        <div class="feature-item"><span class="feat-icon">‚ú®</span> Hi-Res Audio</div>
                        <div class="feature-item"><span class="feat-icon">üìú</span> Auto Metadata</div>
                        <div class="feature-item"><span class="feat-icon">üßπ</span> Auto Clean</div>
                    </div>
                </div>
            </div>
            <div class="login-form-side">
                <div class="login-card">
                    <h2>Authentication</h2>
                    <p>Please enter your dashboard password to continue.</p>
                    <form id="login-form">
                        <div class="form-group">
                            <input type="password" id="login-password" placeholder="Dashboard Password" required
                                autofocus>
                        </div>
                        <button type="submit" class="btn primary" style="width: 100%;">Login to Dashboard</button>
                    </form>
                    <div id="login-error" class="login-error"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mini Audio Player -->
    <div id="audio-player-bar" class="mini-player">
        <audio id="audio-element"></audio>
        <div class="mini-player-content">
            <img id="player-cover" src="" alt="" class="mini-player-cover">
            <div class="mini-player-info">
                <div id="player-title" class="mini-player-title">No track</div>
                <div id="player-artist" class="mini-player-artist">-</div>
            </div>
            <div class="mini-player-controls">
                <button id="player-play" class="mini-player-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                </button>
            </div>
            <div class="mini-player-progress">
                <input type="range" id="player-seek" min="0" max="100" value="0">
                <span id="player-current-time">0:00</span>
            </div>
            <div id="player-quality" class="mini-player-quality">-</div>
            <button class="mini-player-close" onclick="closePlayer()" title="Close">‚úï</button>
        </div>
        <input type="range" id="player-volume" min="0" max="100" value="80" style="display:none;">
        <span id="player-duration" style="display:none;">0:00</span>
    </div>

    <div id="toast-container" class="toast-container"></div>
    <script src="app.js"></script>
</body>

</html>