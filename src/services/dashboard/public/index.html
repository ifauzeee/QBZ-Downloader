<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qobuz Downloader Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script src="/socket.io/socket.io.js"></script>
</head>

<body class="dark-theme">
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üéµ</span>
                <h1>QBZ-DL</h1>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-tab="queue">
                    <span class="icon">üì•</span> Queue
                </a>
                <a href="#" class="nav-item" data-tab="search">
                    <span class="icon">üîç</span> Search
                </a>
                <a href="#" class="nav-item" data-tab="playlists">
                    <span class="icon">üîÑ</span> Playlists
                </a>
                <a href="#" class="nav-item" data-tab="history">
                    <span class="icon">üìú</span> History
                </a>
                <a href="#" class="nav-item" data-tab="settings">
                    <span class="icon">‚öôÔ∏è</span> Settings
                </a>
            </nav>
            <div class="status-card">
                <h3>Status</h3>
                <div class="status-indicator online">
                    <span class="dot"></span> Online
                </div>
                <div class="queue-stats-mini">
                    <div>Pending: <span id="stat-pending">0</span></div>
                    <div>Active: <span id="stat-active">0</span></div>
                </div>
            </div>
        </aside>
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <main class="main-content">
            <header class="top-bar">
                <div class="header-left" style="display: flex; align-items: center; gap: 15px;">
                    <button id="menu-toggle" class="btn secondary icon-btn mobile-only">‚ò∞</button>
                    <h2 id="page-title">Download Queue</h2>
                </div>
                <div class="header-right" style="display: flex; gap: 10px;">
                    <button id="theme-toggle" class="btn secondary icon-btn" title="Toggle Theme">üåì</button>
                    <button id="add-btn" class="btn primary">
                        <span class="icon">+</span> <span class="desktop-only">Add URL</span>
                    </button>
                </div>
            </header>

            <div id="view-queue" class="view-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total</h3>
                        <div class="number" id="q-total">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Downloading</h3>
                        <div class="number text-accent" id="q-downloading">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Completed</h3>
                        <div class="number text-success" id="q-completed">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Failed</h3>
                        <div class="number text-danger" id="q-failed">0</div>
                    </div>
                </div>

                <div class="queue-toolbar">
                    <div class="queue-actions">
                        <button class="btn secondary" onclick="queueAction('pause')">‚è∏Ô∏è Pause</button>
                        <button class="btn secondary" onclick="queueAction('resume')">‚ñ∂Ô∏è Resume</button>
                        <button class="btn danger" onclick="queueAction('clear')">üóëÔ∏è Clear All</button>
                    </div>
                </div>

                <div class="list-container">
                    <div class="list-header">
                        <div>Title</div>
                        <div>Type</div>
                        <div>Quality</div>
                        <div>Status</div>
                        <div>Progress</div>
                        <div>Action</div>
                    </div>
                    <div id="queue-list" class="list-body">
                    </div>
                </div>
            </div>

            <div id="view-search" class="view-section" style="display: none;">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search...">
                        <button class="btn primary" id="search-btn">Search</button>
                    </div>
                    <div class="search-types">
                        <button class="type-btn active" data-type="albums">Albums</button>
                        <button class="type-btn" data-type="tracks">Tracks</button>
                        <button class="type-btn" data-type="artists">Artists</button>
                    </div>
                </div>
                <div id="search-results" class="results-grid">
                    <div style="grid-column: 1/-1; text-align: center; color: #666; padding: 50px;">
                        Start searching to see results
                    </div>
                </div>
                <div id="search-pagination" class="pagination"></div>
            </div>

            <div id="view-album" class="view-section" style="display: none;">
                <button class="btn secondary" onclick="switchTab('search')" style="margin-bottom: 20px;">
                    <span class="icon">‚¨ÖÔ∏è</span> Back to Search
                </button>
                <div id="album-full-content">
                    <!-- Album content here -->
                </div>
            </div>

            <div id="view-artist" class="view-section" style="display: none;">
                <button class="btn secondary" onclick="switchTab('search')" style="margin-bottom: 20px;">
                    <span class="icon">‚¨ÖÔ∏è</span> Back to Search
                </button>
                <div id="artist-full-content">
                </div>
                <div id="artist-pagination" class="pagination"></div>
            </div>

            <div id="view-playlists" class="view-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Watched Playlists</h3>
                    <button id="add-playlist-btn" class="btn primary">
                        <span class="icon">+</span> Track New Playlist
                    </button>
                </div>
                <div class="list-container">
                    <div class="list-header" style="grid-template-columns: 2fr 1fr 1fr 1fr 1fr;">
                        <div>Title</div>
                        <div>Quality</div>
                        <div>Interval (Hrs)</div>
                        <div>Last Sync</div>
                        <div>Action</div>
                    </div>
                    <div id="playlists-list" class="list-body">
                    </div>
                </div>
            </div>

            <div id="view-history" class="view-section" style="display: none;">
                <div style="margin-bottom: 20px; display: flex; justify-content: flex-end;">
                    <button id="clear-history-btn" class="btn danger">
                        <span class="icon">üóëÔ∏è</span> Delete All History
                    </button>
                </div>
                <div class="list-container">
                    <div class="list-header">
                        <div>Date</div>
                        <div>Title</div>
                        <div>Quality</div>
                        <div>Filename</div>
                        <div>Action</div>
                    </div>
                    <div id="history-list" class="list-body">
                    </div>
                </div>
            </div>

            <div id="view-settings" class="view-section" style="display: none;">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>Qobuz Credentials</h3>
                        <div class="form-group">
                            <label>App ID</label>
                            <input type="password" id="setting-QOBUZ_APP_ID">
                        </div>
                        <div class="form-group">
                            <label>App Secret</label>
                            <input type="password" id="setting-QOBUZ_APP_SECRET">
                        </div>
                        <div class="form-group">
                            <label>User Auth Token</label>
                            <input type="password" id="setting-QOBUZ_USER_AUTH_TOKEN">
                        </div>
                        <div class="form-group">
                            <label>User ID</label>
                            <input type="text" id="setting-QOBUZ_USER_ID">
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Telegram Bot Config</h3>
                        <div class="form-group">
                            <label>Bot Token</label>
                            <input type="password" id="setting-TELEGRAM_BOT_TOKEN">
                        </div>
                        <div class="form-group">
                            <label>Chat ID</label>
                            <input type="text" id="setting-TELEGRAM_CHAT_ID">
                        </div>
                        <div class="form-group">
                            <label>Allowed User IDs (comma separated)</label>
                            <input type="text" id="setting-telegram-allowedUsers" placeholder="Leave empty for all">
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>General Settings</h3>
                        <div class="form-group">
                            <label>Default Quality</label>
                            <select id="setting-defaultQuality">
                                <option value="27">FLAC 24-bit (Hi-Res Max)</option>
                                <option value="7">FLAC 24-bit (Hi-Res)</option>
                                <option value="6">FLAC 16-bit (CD Quality)</option>
                                <option value="5">MP3 320kbps</option>
                                <option value="ask">Ask every time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-embedLyrics"> Embed Lyrics in file
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-embedCover"> Embed Cover Art in file
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Lyrics Format</label>
                            <select id="setting-metadata-lyricsType">
                                <option value="both">Both (LRC + TXT)</option>
                                <option value="synced">Synced (LRC) Only</option>
                                <option value="plain">Plain Text (TXT) Only</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Download Engine</h3>
                        <div class="form-group">
                            <label>Download Path</label>
                            <input type="text" id="setting-downloads-path" placeholder="./downloads">
                        </div>
                        <div class="form-group">
                            <label>Max Concurrent Downloads</label>
                            <input type="number" id="setting-downloads-concurrent" min="1" max="10">
                        </div>
                        <div class="form-group">
                            <label>Retry Attempts</label>
                            <input type="number" id="setting-downloads-retryAttempts" min="0" max="5">
                        </div>
                        <div class="form-group">
                            <label>Retry Delay (ms)</label>
                            <input type="number" id="setting-downloads-retryDelay" min="500" step="500">
                        </div>
                        <div class="form-group">
                            <label>HTTP Proxy URL</label>
                            <input type="text" id="setting-downloads-proxy" placeholder="http://user:pass@host:port">
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Metadata & Assets</h3>
                        <div class="form-group">
                            <label>Cover Art Size</label>
                            <select id="setting-metadata-coverSize">
                                <option value="max">Maximum (Original)</option>
                                <option value="600">Large (600x600)</option>
                                <option value="300">Small (300x300)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-metadata-saveCoverFile"> Save cover.jpg separately
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-metadata-saveLrcFile"> Save .lrc file separately
                            </label>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>File & Folder Naming</h3>
                        <div class="form-group">
                            <label>Folder Template</label>
                            <input type="text" id="setting-downloads-folderTemplate">
                            <small>{artist}, {album}, {year}, {quality}</small>
                        </div>
                        <div class="form-group">
                            <label>File Template</label>
                            <input type="text" id="setting-downloads-fileTemplate">
                            <small>{track_number}, {title}, {artist}, {album}</small>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Interface & Cleanup</h3>
                        <div class="form-group">
                            <label>Dashboard Auto-Clean (hours, 0 to disable)</label>
                            <input type="number" id="setting-dashboard-autoCleanHours" min="0">
                        </div>
                        <div class="form-group">
                            <label>Color Scheme</label>
                            <select id="setting-display-colorScheme">
                                <option value="gradient">Gradient (Default)</option>
                                <option value="dark">Dark / Minimal</option>
                                <option value="light">Light</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Terminal Verbosity</label>
                            <select id="setting-display-verbosity">
                                <option value="detailed">Detailed (Show All)</option>
                                <option value="normal">Normal</option>
                                <option value="quiet">Quiet (Errors Only)</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Telegram Integration</h3>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-telegram-uploadFiles"> Auto-upload to Telegram
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting-telegram-autoDelete"> Delete local file after upload
                            </label>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: right; padding-bottom: 40px;">
                    <button class="btn primary" onclick="saveSettings()">Save All Settings</button>
                </div>
            </div>
        </main>
    </div>

    <div id="add-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-modal')">&times;</span>
            <h2>Add Download</h2>
            <form id="add-form">
                <div class="form-group">
                    <label>Qobuz URL</label>
                    <input type="text" id="url-input" placeholder="https://play.qobuz.com/album/..." required>
                </div>
                <div class="form-group">
                    <label>Quality</label>
                    <select id="quality-input">
                        <option value="27">Hi-Res 24/192 (Default)</option>
                        <option value="7">Hi-Res 24/96</option>
                        <option value="6">CD Quality (16/44.1)</option>
                        <option value="5">MP3 320kbps</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary">Add to Queue</button>
                </div>
            </form>
        </div>
        <div id="add-playlist-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('add-playlist-modal')">&times;</span>
                <h2>Track Playlist</h2>
                <form id="add-playlist-form">
                    <div class="form-group">
                        <label>Playlist URL or ID</label>
                        <input type="text" id="playlist-id-input" placeholder="https://open.qobuz.com/playlist/..."
                            required>
                    </div>
                    <div class="form-group">
                        <label>Quality</label>
                        <select id="playlist-quality-input">
                            <option value="27">Hi-Res 24/192</option>
                            <option value="7">Hi-Res 24/96</option>
                            <option value="6">CD Quality (16/44.1)</option>
                            <option value="5">MP3 320kbps</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Sync Interval (Hours)</label>
                        <input type="number" id="playlist-interval-input" min="1" value="24" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn primary">Start Tracking</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="login-overlay" class="login-overlay" style="display: none;">
            <div class="login-split-container">
                <!-- Left Side: Brand Section -->
                <div class="login-brand-side">
                    <div class="brand-content">
                        <div class="logo">
                            <span class="logo-icon">üéµ</span>
                            <h1>QBZ-DL</h1>
                        </div>
                        <h2>Premium Hi-Res Downloader</h2>
                        <p>Access the ultimate toolkit for high-fidelity audio. Manage your queue, search the library,
                            and
                            enjoy your music with complete metadata and lyrics.</p>
                        <div class="brand-features">
                            <div class="feature-item"><span class="feat-icon">üöÄ</span> Fast Downloads</div>
                            <div class="feature-item"><span class="feat-icon">‚ú®</span> Hi-Res Audio</div>
                            <div class="feature-item"><span class="feat-icon">üìú</span> Auto Metadata</div>
                            <div class="feature-item"><span class="feat-icon">üßπ</span> Auto Clean</div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Login Section -->
                <div class="login-form-side">
                    <div class="login-card">
                        <h2>Authentication</h2>
                        <p>Please enter your dashboard password to continue.</p>
                        <form id="login-form">
                            <div class="form-group">
                                <input type="password" id="login-password" placeholder="Dashboard Password" required
                                    autofocus>
                            </div>
                            <button type="submit" class="btn primary" style="width: 100%;">Login to Dashboard</button>
                        </form>
                        <div id="login-error" class="login-error"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="toast-container" class="toast-container"></div>
        <script src="app.js"></script>
</body>

</html>